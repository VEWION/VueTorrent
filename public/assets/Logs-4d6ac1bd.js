import{d as r,a as p}from"./vue-9ef19677.js";import{a5 as u,b3 as s,r as m,aq as g,b4 as c,b5 as _,Q as d,b6 as y,s as h,A as a,B as i,E as f,x as v,y as n,_ as b,I as T,ay as x,J as L,K as C,L as k}from"./index-2955a708.js";import{_ as I}from"./VDataTable-55ac2f90.js";const F=r({name:"Logs",mixins:[u],data(){return{headers:[{text:this.$t("modals.logs.table.id"),value:"id",sortable:!0},{text:this.$t("modals.logs.table.type"),value:"type",sortable:!0},{text:this.$t("modals.logs.table.message"),value:"message",sortable:!0},{text:this.$t("modals.logs.table.timestamp"),value:"timestamp",sortable:!0}],logTypeOptions:[{text:s[s.NORMAL],value:s.NORMAL},{text:s[s.INFO],value:s.INFO},{text:s[s.WARNING],value:s.WARNING},{text:s[s.CRITICAL],value:s.CRITICAL}],logTypeFilter:[1,2,4,8],timer:null,logs:[],mdiClose:m}},computed:{...p(["webuiSettings"]),lastFetchedId(){return this.logs.length>0?this.logs[this.logs.length-1].id:-1},filteredLogs(){return this.logs.filter(l=>this.logTypeFilter.includes(l.type))},selectAllIcon(){return this.logTypeFilter.length===0?g:this.logTypeFilter.length===this.logTypeOptions.length?c:_}},mounted(){document.addEventListener("keydown",this.handleKeyboardShortcut),this.timer=setInterval(this.updateLogs,15e3),this.updateLogs()},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyboardShortcut),clearInterval(this.timer)},methods:{async updateLogs(){this.logs.push(...await d.getLogs(this.lastFetchedId)),await this.$nextTick()},getLogTypeClassName(l){return`logtype-${s[l.type].toLowerCase()}`},getLogTypeName(l){return s[l.type]},formatLogTimestamp(l){return y(l.timestamp*1e3).format(this.webuiSettings.dateFormat)},async toggleSelectAll(){this.logTypeFilter.length===this.logTypeOptions.length?this.logTypeFilter=[]:this.logTypeFilter=this.logTypeOptions.map(l=>l.value),await this.$nextTick()},close(){this.$router.back()},handleKeyboardShortcut(l){l.key==="Escape"&&this.close()}}});var A=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"px-1 px-sm-5 background noselect"},[t(a,{staticClass:"grey--text",attrs:{"no-gutters":"",align:"center",justify:"center"}},[t(i,[t("h1",{staticClass:"subtitle-1 ml-2",staticStyle:{"font-size":"1.6em !important"}},[e._v(" "+e._s(e.$t("modals.logs.title"))+" ")])]),t(i,{staticClass:"align-center justify-center"},[t(f,{staticClass:"justify-end"},[t(v,{attrs:{small:"",elevation:"0"},on:{click:e.close}},[t(n,[e._v(e._s(e.mdiClose))])],1)],1)],1)],1),t(a,{staticClass:"ma-0 pa-0"},[t(I,{attrs:{id:"logsTable",headers:e.headers,"footer-props":{itemsPerPageOptions:[50,100,250,500,1e3,-1]},items:e.filteredLogs,"items-per-page":50,"item-key":"id","multi-sort":"","sort-by":["id"],"sort-desc":[!0],"item-class":e.getLogTypeClassName},scopedSlots:e._u([{key:"top",fn:function(){return[t("div",{staticClass:"mx-4 mb-5"},[t(b,{attrs:{items:e.logTypeOptions,label:e.$t("modals.logs.filters.type"),multiple:"",chips:""},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[t(T,{attrs:{ripple:""},on:{mousedown:function(o){o.preventDefault()},click:e.toggleSelectAll}},[t(x,[t(n,[e._v(e._s(e.selectAllIcon))])],1),t(L,[t(C,[e._v(e._s(e.$t("selectAll")))])],1)],1)]},proxy:!0}]),model:{value:e.logTypeFilter,callback:function(o){e.logTypeFilter=o},expression:"logTypeFilter"}})],1),t(k)]},proxy:!0},{key:"item.type",fn:function({item:o}){return[e._v(" "+e._s(e.getLogTypeName(o))+" ")]}},{key:"item.timestamp",fn:function({item:o}){return[e._v(" "+e._s(e.formatLogTimestamp(o))+" ")]}}],null,!0)})],1)],1)},$=[],N=h(F,A,$,!1,null,null,null,null);const R=N.exports;export{R as default};
