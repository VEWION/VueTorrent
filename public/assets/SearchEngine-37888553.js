import{d as _,a as p}from"./vue-9ef19677.js";import{a5 as f,r as g,av as y,b7 as v,Q as n,s as x,A as i,B as r,E as S,x as l,y as c,t as u,I as h,a as d,_ as m}from"./index-2955a708.js";import{_ as C}from"./VDataTable-55ac2f90.js";const b=_({name:"SearchEngine",mixins:[f],data(){return{headers:[{text:"Filename",value:"fileName"},{text:"File Size",value:"fileSize"},{text:"Seeders",value:"nbSeeders"},{text:"Leechers",value:"nbLeechers"},{text:"Site URL",value:"siteUrl"},{text:"",value:"actions",sortable:!1}],searchPattern:"",searchCategory:"all",searchPlugin:"enabled",queryId:0,queryTimer:NaN,queryResults:[],resultFilter:"",mdiClose:g,mdiDownload:y,mdiToyBrick:v}},computed:{...p(["searchPlugins"]),categories(){const a=[{text:"Movies",value:"movies"},{text:"TV shows",value:"tv"},{text:"Music",value:"music"},{text:"Games",value:"games"},{text:"Anime",value:"anime"},{text:"Software",value:"software"},{text:"Pictures",value:"pictures"},{text:"Books",value:"books"}];return a.sort((e,t)=>e.text.localeCompare(t.text)),[{text:"All categories",value:"all"},...a]},plugins(){const a=[{text:"All plugins",value:"all"},{text:"Only enabled",value:"enabled"}];return this.searchPlugins.filter(e=>e.enabled).forEach(e=>a.push({text:e.fullName,value:e.name})),a},filteredResults(){return this.queryResults}},async mounted(){await this.$store.dispatch("FETCH_SEARCH_PLUGINS")},async beforeDestroy(){await this.stopSearch()},methods:{openPluginManager(){this.createModal("SearchPluginManager")},close(){this.$router.back()},async runNewSearch(){const a=await n.startSearch(this.searchPattern,this.searchCategory,[this.searchPlugin]);this.queryId=a.id,this.queryTimer=setInterval(()=>this.refreshResults(),1e3)},async stopSearch(){this.queryId!==0&&await n.stopSearch(this.queryId),this.queryId=0,clearInterval(this.queryTimer)},async refreshResults(){const a=await n.getSearchResults(this.queryId,100,this.queryResults.length);this.queryResults.push(...a.results),a.status==="Stopped"&&(this.queryId=0,await this.stopSearch())},downloadTorrent(a){this.createModal("AddModal",{initialMagnet:a.fileUrl})},customFilter(a,e,t){const s=e.trim().toLowerCase().split(" ");return a!=null&&e!=null&&typeof a=="string"&&s.every(o=>a.toString().toLowerCase().indexOf(o)!==-1)}}});var w=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"px-1 px-sm-5 background noselect"},[t(i,{staticClass:"grey--text",attrs:{"no-gutters":"",align:"center",justify:"center"}},[t(r,[t("h1",{staticClass:"subtitle-1 ml-2",staticStyle:{"font-size":"1.6em !important"}},[e._v(" "+e._s(e.$t("search.title"))+" ")])]),t(r,{staticClass:"align-center justify-center"},[t(S,{staticClass:"justify-end"},[t(l,{attrs:{small:"",elevation:"0",color:"primary"},on:{click:e.openPluginManager}},[t(c,[e._v(e._s(e.mdiToyBrick))])],1),t(l,{attrs:{small:"",elevation:"0"},on:{click:e.close}},[t(c,[e._v(e._s(e.mdiClose))])],1)],1)],1)],1),t(u,{attrs:{flat:""}},[t(h,{staticClass:"searchCriterias"},[t(i,{staticClass:"my-2"},[t(r,{attrs:{cols:"12",md:"6"}},[t(d,{attrs:{dense:"","hide-details":"",clearable:"",rules:[s=>!!s||"Search term is required"],label:"Search pattern"},on:{keydown:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:(s.preventDefault(),e.runNewSearch.apply(null,arguments))}},model:{value:e.searchPattern,callback:function(s){e.searchPattern=s},expression:"searchPattern"}})],1),t(r,{attrs:{cols:"6",sm:"5",md:"2"}},[t(m,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.categories,label:"Search category"},model:{value:e.searchCategory,callback:function(s){e.searchCategory=s},expression:"searchCategory"}})],1),t(r,{attrs:{cols:"6",sm:"5",md:"2"}},[t(m,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.plugins,label:"Search plugins"},model:{value:e.searchPlugin,callback:function(s){e.searchPlugin=s},expression:"searchPlugin"}})],1),t(r,{staticClass:"d-flex align-center justify-center",attrs:{cols:"12",sm:"2"}},[e.queryId===0?t(l,{staticClass:"mx-auto accent white--text elevation-0 px-4",on:{click:e.runNewSearch}},[e._v(" "+e._s(e.$t("search.runNewSearch"))+" ")]):t(l,{staticClass:"mx-auto warning white--text elevation-0 px-4",on:{click:e.stopSearch}},[e._v(" "+e._s(e.$t("search.stopSearch"))+" ")])],1)],1)],1)],1),t(u,{staticClass:"mt-5",attrs:{flat:""}},[t(h,{staticClass:"searchResults"},[t(C,{staticStyle:{width:"100%"},attrs:{id:"searchResultsTable",headers:e.headers,items:e.filteredResults,search:e.resultFilter,"custom-filter":e.customFilter},scopedSlots:e._u([{key:"top",fn:function(){return[t(i,{staticClass:"mt-2"},[t(r,{attrs:{cols:"12",md:"6"}},[t(d,{attrs:{dense:"","hide-details":"",label:"Filter"},model:{value:e.resultFilter,callback:function(s){e.resultFilter=s},expression:"resultFilter"}})],1)],1)]},proxy:!0},{key:"item.fileSize",fn:function({item:s}){return[e._v(" "+e._s(e._f("formatSize")(s.fileSize))+" ")]}},{key:"item.actions",fn:function({item:s}){return[t("span",{staticClass:"search-actions"},[t(c,{on:{click:function(o){return e.downloadTorrent(s)}}},[e._v(e._s(e.mdiDownload))])],1)]}}])})],1)],1)],1)},k=[],P=x(b,w,k,!1,null,"319a1514",null,null);const I=P.exports;export{I as default};
